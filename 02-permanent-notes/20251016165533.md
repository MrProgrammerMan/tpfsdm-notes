---
title: Nix Derivations
id: 20251016165553
tags: []
---
# Nix derivations
Derivations are at the core of the nix language. A nix derivation is a set of codified build instructions for producing a set of files. Usually these files are some kind of binary software of program that can be run. The builtin function `derivation` can be used to create a derivation. It requires an attribute set with the fields `name`, `system` and `builder`. When the derivation function is evaluated, it runs the `builder` executable. The derivation is considered successful if the builder runs without issue and creates the folder `$out`. There are other attributes that can optionally be provided to further costumize the derivation. Theres also the possibility of hooking into various phases, executed at different points in the derivations evaluation. Usually, derivations are created using various wrapper functions.

## Example
```nix
derivation {
  name = "gnu-hello";
  system = builtins.currentSystem;
  builder = "/bin/sh";
  args = [ "-c" ''
    tar xf $src
    cd hello-*
    ./configure --prefix=$out
    make
    make install
  '' ];
  src = builtins.fetchurl {
    url = "https://ftp.gnu.org/gnu/hello/hello-2.12.1.tar.gz";
    sha256 = "1l6kzks4wrb5y4dqg0d06vyw5jgwfkzbdn3dr7lwc87c6ccm3iyv";
  };
}
```

## Wrapper functions
`derivation` is primitive and almost never used directly. Instead, several different wrappers exist that fulfill different purposes.

### mkDerivation
The simplest wrapper. General purpose.
```nix
{ stdenv, fetchurl }:

stdenv.mkDerivation {
  pname = "hello";
  version = "2.12.1";

  src = fetchurl {
    url = "https://ftp.gnu.org/gnu/hello/hello-${version}.tar.gz";
    sha256 = "1l6kzks4wrb5y4dqg0d06vyw5jgwfkzbdn3dr7lwc87c6ccm3iyv";
  };

  meta.description = "A program that produces a familiar, friendly greeting";
}
```

### 2. Rust project (buildRustPackage)
Several wrappers exist for typical software source code in different languages and/or framworks.
```nix
{ rustPlatform, fetchFromGitHub }:
rustPlatform.buildRustPackage {
  pname = "hello-rust";
  version = "0.1.0";
  src = fetchFromGitHub {
    owner = "example"; repo = "hello-rust";
    rev = "v0.1.0";
    sha256 = "sha256-AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=";
  };
  cargoSha256 = "sha256-BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB=";
  meta.description = "Rust Hello World";
}
```

### 3. Dev Shell (mkShell)
Dev shells allow specifying tools needed. While in the shell, the tools are available. After exiting the shell, the tools are no longer available. This allows seperation and sharing of project tooling.
```nix
{ pkgs ? import <nixpkgs> {} }:
pkgs.mkShell {
  name = "hello-dev";
  buildInputs = [ pkgs.rustc pkgs.cargo pkgs.gcc ];
  shellHook = ''echo "Welcome to the dev shell!"'';
}
```

### 4. NixOS Test (nixosTest)
Nix allows running full integration tests with NixOS VMs. Neat.
```nix
{ pkgs, ... }:
import <nixpkgs/nixos/tests/make-test-python.nix> ({
  name = "hello-test";
  nodes.machine = { ... }: {
    environment.systemPackages = [ pkgs.hello ];
  };
  testScript = ''
    machine.start()
    machine.succeed("hello | grep 'Hello, world!'")
  '';
})
```

### 5. Other useful helpers
- buildGoModule → Go projects
- buildPythonPackage → Python projects
- buildNodePackage → Node.js projects
- writeShellScriptBin → Simple shell wrappers
- runCommand → Ad-hoc shell derivations
- dockerTools.buildImage → Build container images
- nixosSystem → Build nixOS system configurations


