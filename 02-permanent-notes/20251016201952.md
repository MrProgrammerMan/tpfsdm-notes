---
title: Flake - packages
id: 20251016202007
tags: []
---
# [Flake]([[20251016181621]]) - packages
One of the standard output attributes of a flake. Takes the following form: `packages."<system>"."<name>" = derivation;`. You can specify a default package: `packages."<system>".default = derivation;`. Also, see [system]([[20251016202334]]).

A package must be a [derivation]([[20251016165533]]).

The package is built by `nix build .#<name>`. The name can be omitted for the default package.

## Derivation wrappers
There are some common `derivation` wrapper functions used when exposing a package in a flake.

### mkDerivation
`mkDerivation` is the most general-purpose wrapper. It’s the core function from `stdenv` used to create derivations in Nixpkgs. It allows you to specify all the build steps and dependencies in a structured way.

Typical usage:
```nix
{ stdenv, fetchurl }:

stdenv.mkDerivation {
  pname = "hello";
  version = "2.12";

  src = fetchurl {
    url = "https://ftp.gnu.org/gnu/hello/hello-${version}.tar.gz";
    sha256 = "0ssi1wpaf7plaswqqjwigppsg5fyh99vdlb9kzl7c9lng89ndq1i";
  };

  buildInputs = [];  # dependencies needed at build time

  meta = {
    description = "A program that prints Hello, World!";
    license = stdenv.lib.licenses.gpl3;
  };
}
```
- **Pros:** Fully flexible, works with any build system.
- **Cons:** You have to manually specify build phases (`configurePhase`, `buildPhase`, `installPhase`) if the package doesn’t follow standard patterns.

### buildRustPackage
`buildRustPackage` is a specialized wrapper for Rust crates. It automatically sets up the Rust toolchain, fetches dependencies via `cargo`, and handles building and installing the crate.

Typical usage:
```nix
{ lib, buildRustPackage, fetchFromGitHub }:

buildRustPackage rec {
  pname = "ripgrep";
  version = "13.0.0";

  src = fetchFromGitHub {
    owner = "BurntSushi";
    repo = "ripgrep";
    rev = "13.0.0";
    sha256 = "sha256-hash-of-source";
  };

  cargoSha256 = "sha256-of-cargo-lock";  # ensures reproducible builds

  meta = {
    description = "A line-oriented search tool that recursively searches directories for a regex pattern";
    license = lib.licenses.unlicense;
  };
}
```
- **Pros:** Automatically handles Rust builds with cargo. You rarely need to manually tweak build phases.
- **Cons:** Only for Rust packages.

## Flake implementation
See [callPackage]([[]])